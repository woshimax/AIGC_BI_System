# AIGC_BI_System主要功能  

## 一、数据转化  
利用EasyExcel，实现excelToCsv方法，封装进ExcelUtils，其中excelToCsv包括了校验文件为xls和xlsx  
## 二、文件校验、限流  
校验文件大小和后缀，利用Redisson的RateLimiter进行限流  
限流算法用到是令牌桶算法，传入的key来区分不同限流器：设定速率产生令牌并存放在Redis中，请求在到Redis中取得令牌之后才能通过，如果没有令牌则被拒绝
## 三、处理输入数据  
### 1、引入千帆大模型  
### 2、设置预设文本  
包括对象预设，输入样例和输出样例，输入格式和输出格式  
### 3、拼接输入  
对于不同大模型，有不同的操作方式：千帆达模型不支持提前进行预设设定，因此将完整的prompt拼接上用户的输入作为AI的输入传入；同时千帆大模型输出文本的换行是"\\n",需要利用正则表达式处理——这个根据不同模型的反馈进行小规模的修改
有的大模型支持持久化预设，这就不需要每次都拼接预设，节省token耗费  
## 四、生成图表和分析结果  
### 1、实现功能  
生成图表的js代码和文本分析结果：js代码交给ECharts组件处理  
### 2、异步化AI生成过程  
问题：AI生成的过程非常漫长，如果每次传入数据后都等到AI返回，用户体验很差  
解决方式：异步化  
第一次优化：只是发现有时候时间过长会报异常，于是加入了超时重试机制，防止系统不稳定  
第二次优化：加入异步化——利用线程池ThreadPoolExecutor创建线程来进行AI生成，提前把id返回给前端  
第三次优化：优化异步化——为了处理线程池不持久化的问题，使用RabbitMQ来充当任务队列  
### 3、将原始数据进行分表  
在数据量很大的情况下，查原始数据和修改原始数据（csv格式）都是很耗时的，因此单独把原始数据分表出来，表名为chart_{id}  

